# 三角洲行动 - 战利品收集模拟器使用指南

> 版本：1.0.0
> 更新日期：2025-12-06
> 状态：✅ 核心功能完成

---

## 🎮 项目简介

这是一个完整的**三角洲行动战利品收集模拟器**，实现了游戏中的背包管理、物品拖拽、战利品收集等核心玩法。

### 核心特性

- ✅ **完整的玩家背包系统**（双列布局）
- ✅ **多标签页战利品区域**（5个标签页）
- ✅ **智能拖拽系统**（网格对齐、碰撞检测）
- ✅ **动态容器系统**（胸挂、背包）
- ✅ **物品类型限制**（安全箱规则）
- ✅ **交互式标签切换UI**

---

## 📦 系统架构

### 区域布局

```
游戏界面
├── 玩家区域（左侧）
│   ├── 左列：装备栏
│   │   ├── 头盔 (2x2)
│   │   ├── 护甲 (3x3)
│   │   ├── 副武器/手枪 (3x2)
│   │   ├── 主武器1 (5x2)
│   │   └── 主武器2 (5x2)
│   └── 右列：物品栏
│       ├── 胸挂 (4x2 + 动态容器)
│       ├── 口袋 (5个1x1格)
│       ├── 背包 (5x5 + 动态容器)
│       └── 安全箱 (3x3, 有限制)
│
└── 战利品区域（右侧）- 5个标签页
    ├── 📁 地面容器 (15x8)
    ├── 📦 战利品箱1 (7x8)
    ├── 📦 战利品箱2 (7x8)
    ├── 📦 战利品箱3 (7x8)
    └── 👤 敌人战利品 (玩家布局，无安全箱)
```

---

## 🚀 快速开始

### 1. 安装依赖

```bash
cd electron-app
npm install
```

### 2. 编译游戏

```bash
npm run build:game
```

输出：`electron-app/dist/game.bundle.js`

### 3. 运行游戏

```bash
npm start
```

---

## 🎯 功能详解

### 玩家背包系统

#### 左侧装备栏
- **头盔槽**：只能放置头盔
- **护甲槽**：只能放置护甲
- **副武器槽**：只能放置手枪
- **主武器1/2槽**：可放置步枪、冲锋枪、霰弹枪、机枪、狙击枪

#### 右侧物品栏
- **胸挂**：
  - 装备胸挂后，显示胸挂内部格子
  - 可在胸挂内存放物品
  - 卸下胸挂时，内部物品会被清空到地面

- **口袋**：
  - 固定5个独立的1x1格子
  - 适合放置小物品（弹药、药品）

- **背包**：
  - 装备背包后，显示背包内部格子（根据背包大小）
  - 可存放大量物品
  - 卸下背包时，内部物品会被清空

- **安全箱**（3x3）：
  - ⚠️ **限制**：不能放武器、配件、背包、胸挂
  - ✅ **允许**：弹药、消耗品、收藏品等
  - 💰 安全箱中的物品在死亡时不会掉落（游戏设定）

### 战利品区域（5个标签页）

#### 标签页切换
- 点击顶部标签按钮切换不同容器
- 当前标签高亮显示（蓝色）
- 鼠标悬停时显示交互效果

#### 各标签页说明

1. **地面容器** (15x8格)
   - 最大的容器，用于存放所有被丢弃的物品
   - 默认包含15个测试物品

2. **战利品箱1-3** (7x8格)
   - 模拟游戏中的战利品箱
   - 每个箱子包含不同数量的随机物品
   - 箱子1: 10个物品
   - 箱子2: 8个物品
   - 箱子3: 12个物品

3. **敌人战利品** (玩家布局)
   - 与玩家背包相同的布局
   - **没有安全箱**（战利品模式）
   - 可查看敌人装备的武器和物品
   - 默认为空，方便测试

---

## 🎨 交互说明

### 拖拽物品

1. **鼠标按下**：选中物品
2. **拖动**：物品跟随鼠标移动
3. **松开鼠标**：
   - ✅ 绿色预览 = 可以放置
   - ❌ 红色预览 = 无法放置（重叠或类型不符）

### 物品放置规则

- ✅ 格子内有足够空间
- ✅ 不与其他物品重叠
- ✅ 物品类型符合槽位要求
- ❌ 安全箱拒绝武器、配件等

### 动态容器

**胸挂/背包装备时**：
```
1. 将胸挂/背包拖到对应槽位
2. 松开鼠标
3. 自动显示容器内部格子
4. 可以往格子里放物品
```

**胸挂/背包卸下时**：
```
1. 将胸挂/背包从槽位拖出
2. 松开鼠标
3. 容器内部格子消失
4. 内部物品被清空到地面（安全机制）
```

---

## ⌨️ 键盘快捷键

| 快捷键 | 功能 | 状态 |
|--------|------|------|
| `1-5` | 切换战利品标签页 | 🔄 计划中 |
| `Tab` | 切换下一个标签 | 🔄 计划中 |
| `R` | 旋转物品 | 🔄 计划中 |
| `Ctrl+Z` | 撤销操作 | 🔄 计划中 |

---

## 🎭 测试场景

### 场景1：测试装备系统
1. 启动游戏
2. 从战利品箱拖拽武器到主武器槽
3. 拖拽头盔到头盔槽
4. 拖拽护甲到护甲槽

### 场景2：测试动态容器
1. 从战利品箱拖拽一个背包到背包槽
2. 观察背包内部格子出现
3. 拖拽物品到背包内部
4. 将背包从槽位拖出
5. 观察内部物品消失

### 场景3：测试安全箱限制
1. 尝试将武器拖到安全箱
2. 观察红色预览（拒绝）
3. 将弹药拖到安全箱
4. 观察绿色预览（允许）

### 场景4：测试多标签页
1. 点击不同的标签按钮
2. 观察容器切换
3. 查看不同容器的物品
4. 测试标签按钮的高亮效果

---

## 🔧 开发者信息

### 项目结构

```
electron-app/
├── src/game/
│   ├── Game.ts              # 主游戏控制器
│   ├── config.ts            # 游戏配置
│   ├── main.ts              # 入口文件
│   ├── core/
│   │   ├── Region.ts        # 区域容器（带标签页UI）
│   │   ├── Inventory.ts     # 物品栏（4种类型）
│   │   ├── Subgrid.ts       # 网格系统
│   │   ├── GridContainer.ts # 动态容器
│   │   └── DragDropSystem.ts # 拖拽系统
│   ├── entities/
│   │   └── Item.ts          # 物品实体
│   └── managers/
│       └── DataManager.ts   # 数据管理
└── normalized_data/         # 游戏数据（JSON）
```

### Inventory类型

| Type | 名称 | 说明 | 尺寸 |
|------|------|------|------|
| 0 | LOOT | 战利品箱 | 7x8 |
| 1 | PLAYER | 玩家背包（带安全箱） | 自定义 |
| 2 | GROUND | 地面容器 | 15x8 |
| 3 | PLAYER_LOOT | 玩家战利品（无安全箱） | 自定义 |

### 创建新Inventory

```typescript
// 战利品箱
region.addInventory(0, false, '战利品箱');

// 玩家背包
region.addInventory(1, false, '玩家背包');

// 地面容器
region.addInventory(2, false, '地面容器');

// 敌人战利品
region.addInventory(3, false, '敌人战利品');
```

---

## 📊 数据文件

### 物品数据位置

```
normalized_data/
├── items_catalog.json       # 物品总目录 (494KB)
├── weapons_spec.json        # 武器详细数据 (25KB)
├── accessories_spec.json    # 配件数据 (199KB)
├── protection_spec.json     # 防护装备 (70KB)
├── consumables_spec.json    # 消耗品 (15KB)
├── collectibles_spec.json   # 收藏品 (135KB)
└── ammunitions_spec.json    # 弹药数据 (15KB)
```

### 添加测试物品

```typescript
// 在 Game.ts 中
private addTestItemsToInventory(inventory: Inventory, count: number): void {
  for (let i = 0; i < count; i++) {
    const randomItem = this.dataManager.getRandomItemWithPreset('default');
    if (randomItem) {
      const item = new Item(randomItem);
      inventory.addItem(item);
    }
  }
}
```

---

## 🐛 已知问题与限制

### 已知问题
- ❌ 暂无自动化测试
- ❌ 键盘快捷键未实现
- ❌ 物品旋转功能未实现
- ❌ 撤销/重做功能未实现

### 性能优化建议
- 📝 考虑使用纹理图集（Texture Atlas）
- 📝 优化大量物品的渲染
- 📝 添加物品虚拟化（只渲染可见物品）

### 安全注意
- ⚠️ 容器嵌套检查（防止背包放入背包）
- ⚠️ 循环引用检测
- ⚠️ 数据验证

---

## 🎯 未来计划

### 近期计划
- [ ] 添加键盘快捷键支持
- [ ] 实现物品旋转功能
- [ ] 添加音效和动画
- [ ] 优化视觉效果
- [ ] 添加物品详情面板

### 长期计划
- [ ] 保存/加载系统
- [ ] 多玩家支持
- [ ] 自定义配置
- [ ] 统计数据展示
- [ ] 成就系统

---

## 📝 更新日志

### v1.0.0 (2025-12-06)
- ✅ 实现玩家背包双列布局
- ✅ 实现战利品区域（5个标签页）
- ✅ 实现标签页切换UI
- ✅ 实现动态容器系统
- ✅ 实现安全箱物品类型限制
- ✅ 调整容器尺寸（地面15x8，战利品7x8）
- ✅ 添加交互式标签按钮

---

## 💬 反馈与支持

### 问题反馈
如遇到问题，请提供：
- 操作系统版本
- Node.js 版本
- 错误信息截图
- 操作步骤

### 功能建议
欢迎提出新功能建议！

---

## 📄 许可证

MIT License

---

**祝您游戏愉快！** 🎮🎉

---

_最后更新：2025-12-06_
_作者：DFData Team + Claude AI_
