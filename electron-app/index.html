<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DFData Manager - æ¸¸æˆè£…å¤‡æ•°æ®ç®¡ç†å·¥å…·</title>
  <link rel="stylesheet" href="src/styles.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/chart.js@4/dist/chart.umd.js"></script>
</head>
<body>
  <div id="app">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="app-header">
      <div class="header-left">
        <h1 class="app-title">
          <span class="icon">ğŸ®</span>
          DFData Manager
        </h1>
        <span class="app-subtitle">æ¸¸æˆè£…å¤‡æ•°æ®ç®¡ç†å·¥å…·</span>
      </div>
      <div class="header-right">
        <button @click="openGame" class="btn btn-warning">
          <span class="icon">ğŸ®</span> æ‰“å¼€æ¸¸æˆ
        </button>
        <button @click="loadData" class="btn btn-primary">
          <span class="icon">ğŸ“‚</span> åŠ è½½æ•°æ®
        </button>
        <button @click="saveData" class="btn btn-success" :disabled="!dataLoaded">
          <span class="icon">ğŸ’¾</span> ä¿å­˜æ•°æ®
        </button>
      </div>
    </header>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="app-container">
      <!-- ä¾§è¾¹æ  -->
      <aside class="sidebar">
        <nav class="nav-menu">
          <div class="nav-section">
            <h3>æ•°æ®æµè§ˆ</h3>
            <a href="#" @click.prevent="currentView = 'weapons'" :class="{active: currentView === 'weapons'}">
              <span class="icon">ğŸ”«</span> æ­¦å™¨ <span class="badge">{{weaponsCount}}</span>
            </a>
            <a href="#" @click.prevent="currentView = 'accessories'" :class="{active: currentView === 'accessories'}">
              <span class="icon">ğŸ”§</span> é…ä»¶ <span class="badge">{{accessoriesCount}}</span>
            </a>
            <a href="#" @click.prevent="currentView = 'ammunitions'" :class="{active: currentView === 'ammunitions'}">
              <span class="icon">ğŸ’£</span> å¼¹è¯ <span class="badge">{{ammunitionsCount}}</span>
            </a>
            <a href="#" @click.prevent="currentView = 'protection'" :class="{active: currentView === 'protection'}">
              <span class="icon">ğŸ›¡ï¸</span> é˜²æŠ¤è£…å¤‡ <span class="badge">{{protectionCount}}</span>
            </a>
            <a href="#" @click.prevent="currentView = 'collectibles'" :class="{active: currentView === 'collectibles'}">
              <span class="icon">ğŸ’</span> æ”¶é›†å“ <span class="badge">{{collectiblesCount}}</span>
            </a>
            <a href="#" @click.prevent="currentView = 'consumables'" :class="{active: currentView === 'consumables'}">
              <span class="icon">ğŸ§ª</span> æ¶ˆè€—å“ <span class="badge">{{consumablesCount}}</span>
            </a>
          </div>
          <div class="nav-section">
            <h3>ç³»ç»Ÿé…ç½®</h3>
            <a href="#" @click.prevent="currentView = 'slots'" :class="{active: currentView === 'slots'}">
              <span class="icon">ğŸ”Œ</span> æ’æ§½ç³»ç»Ÿ
            </a>
          </div>
          <div class="nav-section">
            <h3>å·¥å…·</h3>
            <a href="#" @click.prevent="currentView = 'statistics'" :class="{active: currentView === 'statistics'}">
              <span class="icon">ğŸ“Š</span> ç»Ÿè®¡åˆ†æ
            </a>
            <a href="#" @click.prevent="currentView = 'search'" :class="{active: currentView === 'search'}">
              <span class="icon">ğŸ”</span> é«˜çº§æœç´¢
            </a>
          </div>
        </nav>

        <!-- æ•°æ®çŠ¶æ€ -->
        <div class="data-status">
          <div class="status-item">
            <span class="label">æ•°æ®çŠ¶æ€:</span>
            <span class="value" :class="dataLoaded ? 'success' : 'warning'">
              {{ dataLoaded ? 'âœ“ å·²åŠ è½½' : 'âš  æœªåŠ è½½' }}
            </span>
          </div>
          <div class="status-item" v-if="dataLoaded">
            <span class="label">æ€»ç‰©å“:</span>
            <span class="value">{{ totalItems }}</span>
          </div>
          <div class="status-item" v-if="dataPath">
            <span class="label">æ•°æ®è·¯å¾„:</span>
            <span class="value small">{{ dataPath }}</span>
          </div>
        </div>
      </aside>

      <!-- ä¸»è§†å›¾åŒºåŸŸ -->
      <main class="main-content">
        <!-- æ¬¢è¿ç•Œé¢ -->
        <div v-if="!dataLoaded && currentView === 'weapons'" class="welcome-screen">
          <div class="welcome-card">
            <div class="welcome-icon">ğŸ®</div>
            <h2>æ¬¢è¿ä½¿ç”¨ DFData Manager</h2>
            <p>è¯·å…ˆåŠ è½½æ•°æ®æ–‡ä»¶ä»¥å¼€å§‹ç®¡ç†æ‚¨çš„æ¸¸æˆè£…å¤‡æ•°æ®</p>
            <button @click="loadData" class="btn btn-primary btn-lg">
              <span class="icon">ğŸ“‚</span> åŠ è½½æ•°æ®æ–‡ä»¶
            </button>
            <div class="welcome-tips">
              <h4>æ”¯æŒçš„æ•°æ®æ–‡ä»¶:</h4>
              <ul>
                <li>normalized_data/items_catalog.json - ç‰©å“ç›®å½•</li>
                <li>normalized_data/weapons_spec.json - æ­¦å™¨æ•°æ®</li>
                <li>normalized_data/accessories_spec.json - é…ä»¶æ•°æ®</li>
                <li>å…¶ä»–è§„èŒƒåŒ–æ•°æ®æ–‡ä»¶...</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- æ­¦å™¨è§†å›¾ -->
        <div v-if="dataLoaded && currentView === 'weapons'" class="data-view">
          <div class="view-header">
            <h2>
              <span class="icon">ğŸ”«</span> æ­¦å™¨ç®¡ç†
            </h2>
            <div class="view-actions">
              <input v-model="searchQuery" type="text" placeholder="æœç´¢æ­¦å™¨..." class="search-input">
              <button @click="addNewItem('weapon')" class="btn btn-sm btn-success">
                <span class="icon">â•</span> æ·»åŠ æ­¦å™¨
              </button>
            </div>
          </div>

          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>å›¾ç‰‡</th>
                  <th>åç§°</th>
                  <th>ç±»å‹</th>
                  <th>å£å¾„</th>
                  <th>ä¼¤å®³</th>
                  <th>ä»·æ ¼</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="weapon in filteredWeapons" :key="weapon.objectID" @click="previewItem(weapon)" class="clickable-row">
                  <td>{{ weapon.objectID }}</td>
                  <td>
                    <img v-if="weapon.picture" :src="weapon.picture" class="item-thumbnail" :alt="weapon.objectName">
                    <span v-else class="no-image">æ— å›¾</span>
                  </td>
                  <td class="item-name">{{ weapon.objectName }}</td>
                  <td><span class="badge badge-type">{{ weapon.type }}</span></td>
                  <td>{{ weapon.caliber }}</td>
                  <td>{{ weapon.meatHarm }}</td>
                  <td class="price">Â¥{{ weapon.avgPrice?.toLocaleString() }}</td>
                  <td class="actions">
                    <button @click.stop="editItem(weapon)" class="btn-icon" title="ç¼–è¾‘">âœï¸</button>
                    <button @click.stop="deleteItem(weapon)" class="btn-icon" title="åˆ é™¤">ğŸ—‘ï¸</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- é…ä»¶è§†å›¾ -->
        <div v-if="dataLoaded && currentView === 'accessories'" class="data-view">
          <div class="view-header">
            <h2>
              <span class="icon">ğŸ”§</span> é…ä»¶ç®¡ç†
            </h2>
            <div class="view-actions">
              <input v-model="searchQuery" type="text" placeholder="æœç´¢é…ä»¶..." class="search-input">
              <select v-model="filterType" class="filter-select">
                <option value="">æ‰€æœ‰ç±»å‹</option>
                <option v-for="type in accessoryTypes" :key="type" :value="type">{{ type }}</option>
              </select>
            </div>
          </div>

          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>å›¾ç‰‡</th>
                  <th>åç§°</th>
                  <th>ç±»å‹</th>
                  <th>å“è´¨</th>
                  <th>ä»·æ ¼</th>
                  <th>å¿«é€Ÿæ‹†å¸</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="accessory in filteredAccessories" :key="accessory.objectID" @click="previewItem(accessory)" class="clickable-row">
                  <td>{{ accessory.objectID }}</td>
                  <td>
                    <img v-if="accessory.picture" :src="accessory.picture" class="item-thumbnail" :alt="accessory.objectName">
                    <span v-else class="no-image">æ— å›¾</span>
                  </td>
                  <td class="item-name">{{ accessory.objectName }}</td>
                  <td><span class="badge badge-type">{{ accessory.type }}</span></td>
                  <td><span class="badge badge-grade grade-{{accessory.grade}}">ç­‰çº§{{ accessory.grade }}</span></td>
                  <td class="price">Â¥{{ accessory.avgPrice?.toLocaleString() }}</td>
                  <td>{{ accessory.quickSeparate ? 'âœ“' : 'âœ—' }}</td>
                  <td class="actions">
                    <button @click.stop="editItem(accessory)" class="btn-icon" title="ç¼–è¾‘">âœï¸</button>
                    <button @click.stop="deleteItem(accessory)" class="btn-icon" title="åˆ é™¤">ğŸ—‘ï¸</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- å¼¹è¯è§†å›¾ -->
        <div v-if="dataLoaded && currentView === 'ammunitions'" class="data-view">
          <div class="view-header">
            <h2>
              <span class="icon">ğŸ’£</span> å¼¹è¯ç®¡ç†
            </h2>
            <div class="view-actions">
              <input v-model="searchQuery" type="text" placeholder="æœç´¢å¼¹è¯..." class="search-input">
            </div>
          </div>

          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>å›¾ç‰‡</th>
                  <th>åç§°</th>
                  <th>å£å¾„</th>
                  <th>ç±»å‹</th>
                  <th>ä¼¤å®³</th>
                  <th>ä»·æ ¼</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="ammo in filteredAmmunitions" :key="ammo.objectID" @click="previewItem(ammo)" class="clickable-row">
                  <td>{{ ammo.objectID }}</td>
                  <td>
                    <img v-if="ammo.picture" :src="ammo.picture" class="item-thumbnail" :alt="ammo.objectName">
                    <span v-else class="no-image">æ— å›¾</span>
                  </td>
                  <td class="item-name">{{ ammo.objectName }}</td>
                  <td>{{ ammo.caliber }}</td>
                  <td><span class="badge badge-type">{{ ammo.type }}</span></td>
                  <td>{{ ammo.meatHarm }}</td>
                  <td class="price">Â¥{{ ammo.avgPrice?.toLocaleString() }}</td>
                  <td class="actions">
                    <button @click.stop="editItem(ammo)" class="btn-icon" title="ç¼–è¾‘">âœï¸</button>
                    <button @click.stop="deleteItem(ammo)" class="btn-icon" title="åˆ é™¤">ğŸ—‘ï¸</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- é˜²æŠ¤è£…å¤‡è§†å›¾ -->
        <div v-if="dataLoaded && currentView === 'protection'" class="data-view">
          <div class="view-header">
            <h2>
              <span class="icon">ğŸ›¡ï¸</span> é˜²æŠ¤è£…å¤‡ç®¡ç†
            </h2>
            <div class="view-actions">
              <input v-model="searchQuery" type="text" placeholder="æœç´¢é˜²æŠ¤è£…å¤‡..." class="search-input">
              <select v-model="filterProtectionType" class="filter-select">
                <option value="">æ‰€æœ‰ç±»å‹</option>
                <option value="helmets">å¤´ç›”</option>
                <option value="armors">æŠ¤ç”²</option>
                <option value="chests">èƒ¸æŒ‚</option>
                <option value="backpacks">èƒŒåŒ…</option>
              </select>
            </div>
          </div>

          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>å›¾ç‰‡</th>
                  <th>åç§°</th>
                  <th>ç±»å‹</th>
                  <th>ç­‰çº§</th>
                  <th>è€ä¹…åº¦</th>
                  <th>ä»·æ ¼</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="item in filteredProtection" :key="item.objectID" @click="previewItem(item)" class="clickable-row">
                  <td>{{ item.objectID }}</td>
                  <td>
                    <img v-if="item.picture" :src="item.picture" class="item-thumbnail" :alt="item.objectName">
                    <span v-else class="no-image">æ— å›¾</span>
                  </td>
                  <td class="item-name">{{ item.objectName }}</td>
                  <td><span class="badge badge-type">{{ item.protectionType }}</span></td>
                  <td><span class="badge badge-grade">ç­‰çº§{{ item.level || item.grade }}</span></td>
                  <td>{{ item.durability }}</td>
                  <td class="price">Â¥{{ item.avgPrice?.toLocaleString() }}</td>
                  <td class="actions">
                    <button @click.stop="editItem(item)" class="btn-icon" title="ç¼–è¾‘">âœï¸</button>
                    <button @click.stop="deleteItem(item)" class="btn-icon" title="åˆ é™¤">ğŸ—‘ï¸</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- æ”¶é›†å“è§†å›¾ -->
        <div v-if="dataLoaded && currentView === 'collectibles'" class="data-view">
          <div class="view-header">
            <h2>
              <span class="icon">ğŸ’</span> æ”¶é›†å“ç®¡ç†
            </h2>
            <div class="view-actions">
              <input v-model="searchQuery" type="text" placeholder="æœç´¢æ”¶é›†å“..." class="search-input">
            </div>
          </div>

          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>å›¾ç‰‡</th>
                  <th>åç§°</th>
                  <th>ç±»å‹</th>
                  <th>å“è´¨</th>
                  <th>é‡é‡</th>
                  <th>ä»·æ ¼</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="item in filteredCollectibles" :key="item.objectID" @click="previewItem(item)" class="clickable-row">
                  <td>{{ item.objectID }}</td>
                  <td>
                    <img v-if="item.picture" :src="item.picture" class="item-thumbnail" :alt="item.objectName">
                    <span v-else class="no-image">æ— å›¾</span>
                  </td>
                  <td class="item-name">{{ item.objectName }}</td>
                  <td><span class="badge badge-type">{{ item.type }}</span></td>
                  <td><span class="badge badge-grade grade-{{item.grade}}">ç­‰çº§{{ item.grade }}</span></td>
                  <td>{{ item.weight }}kg</td>
                  <td class="price">Â¥{{ item.avgPrice?.toLocaleString() }}</td>
                  <td class="actions">
                    <button @click.stop="editItem(item)" class="btn-icon" title="ç¼–è¾‘">âœï¸</button>
                    <button @click.stop="deleteItem(item)" class="btn-icon" title="åˆ é™¤">ğŸ—‘ï¸</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- æ¶ˆè€—å“è§†å›¾ -->
        <div v-if="dataLoaded && currentView === 'consumables'" class="data-view">
          <div class="view-header">
            <h2>
              <span class="icon">ğŸ§ª</span> æ¶ˆè€—å“ç®¡ç†
            </h2>
            <div class="view-actions">
              <input v-model="searchQuery" type="text" placeholder="æœç´¢æ¶ˆè€—å“..." class="search-input">
            </div>
          </div>

          <div class="data-table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>å›¾ç‰‡</th>
                  <th>åç§°</th>
                  <th>ç±»åˆ«</th>
                  <th>å“è´¨</th>
                  <th>é‡é‡</th>
                  <th>ä»·æ ¼</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="item in filteredConsumables" :key="item.objectID" @click="previewItem(item)" class="clickable-row">
                  <td>{{ item.objectID }}</td>
                  <td>
                    <img v-if="item.picture" :src="item.picture" class="item-thumbnail" :alt="item.objectName">
                    <span v-else class="no-image">æ— å›¾</span>
                  </td>
                  <td class="item-name">{{ item.objectName }}</td>
                  <td><span class="badge badge-type">{{ item.thirdClassCN }}</span></td>
                  <td><span class="badge badge-grade grade-{{item.grade}}">ç­‰çº§{{ item.grade }}</span></td>
                  <td>{{ item.weight }}kg</td>
                  <td class="price">Â¥{{ item.avgPrice?.toLocaleString() }}</td>
                  <td class="actions">
                    <button @click.stop="editItem(item)" class="btn-icon" title="ç¼–è¾‘">âœï¸</button>
                    <button @click.stop="deleteItem(item)" class="btn-icon" title="åˆ é™¤">ğŸ—‘ï¸</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- æ’æ§½ç³»ç»Ÿè§†å›¾ -->
        <div v-if="dataLoaded && currentView === 'slots'" class="data-view">
          <div class="view-header">
            <h2>
              <span class="icon">ğŸ”Œ</span> æ’æ§½ç³»ç»Ÿé…ç½®
            </h2>
            <div class="view-actions">
              <button @click="openSlotTester" class="btn btn-primary">
                <span class="icon">ğŸ§ª</span> æ‰“å¼€æ’æ§½æµ‹è¯•å™¨
              </button>
            </div>
          </div>

          <div class="slots-info">
            <div class="info-card">
              <h3>æ’æ§½ç³»ç»Ÿæ¦‚è§ˆ</h3>
              <div class="stat-item">
                <span class="label">æ€»æ’æ§½ç±»å‹:</span>
                <span class="value">{{ slotTypesCount }}</span>
              </div>
              <div class="stat-item">
                <span class="label">æ­¦å™¨æ’æ§½é…ç½®:</span>
                <span class="value">{{ weaponSlotsCount }}</span>
              </div>
              <div class="stat-item">
                <span class="label">å…¼å®¹æ€§é…ç½®:</span>
                <span class="value">{{ compatibilityCount }}</span>
              </div>
            </div>

            <div class="info-card">
              <h3>ç³»ç»Ÿè¯´æ˜</h3>
              <p>æ’æ§½ç³»ç»Ÿå®šä¹‰äº†æ­¦å™¨ä¸é…ä»¶ä¹‹é—´çš„å…¼å®¹æ€§å…³ç³»ã€‚æ¯ä¸ªæ­¦å™¨éƒ½æœ‰ç‰¹å®šçš„æ’æ§½é…ç½®ï¼Œä¸åŒçš„é…ä»¶å¯ä»¥å®‰è£…åœ¨å¯¹åº”çš„æ’æ§½ä¸Šã€‚</p>
              <p><strong>ä¸»è¦åŠŸèƒ½:</strong></p>
              <ul>
                <li>å®šä¹‰æ­¦å™¨æ’æ§½ç±»å‹å’Œä½ç½®</li>
                <li>ç®¡ç†é…ä»¶ä¸æ’æ§½çš„å…¼å®¹æ€§</li>
                <li>æ”¯æŒåŠ¨æ€æ’æ§½ç³»ç»Ÿ</li>
                <li>é…ç½®å®‰è£…é™åˆ¶å’Œè¦æ±‚</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- æ’æ§½æµ‹è¯•å™¨å¯¹è¯æ¡† -->
        <div v-if="slotTesterActive" class="modal-overlay slot-tester-modal" @click="closeSlotTester">
          <div class="modal-dialog slot-tester-dialog" @click.stop>
            <div class="modal-header">
              <h3>ğŸ§ª æ’æ§½é…ç½®æµ‹è¯•å™¨</h3>
              <button @click="closeSlotTester" class="btn-close">âœ•</button>
            </div>

            <div class="modal-body slot-tester-body">
              <!-- æ­¦å™¨é€‰æ‹© -->
              <div class="weapon-selector-section">
                <select v-model="selectedWeaponId" @change="selectWeaponForTester(selectedWeaponId)" class="weapon-selector">
                  <option :value="null">è¯·é€‰æ‹©æ­¦å™¨...</option>
                  <option v-for="weapon in weaponsData" :key="weapon.objectID" :value="weapon.objectID">
                    {{ weapon.objectName }} ({{ weapon.type }})
                  </option>
                </select>
              </div>

              <!-- æ­¦å™¨å±•ç¤ºåŒº -->
              <div v-if="selectedWeapon" class="weapon-display-area">
                <div class="weapon-image-container">
                  <img v-if="selectedWeapon.picture" :src="selectedWeapon.picture" :alt="selectedWeapon.objectName" class="weapon-large-image">
                  <div v-else class="weapon-no-image">æš‚æ— å›¾ç‰‡</div>
                </div>
                <div class="weapon-info-compact">
                  <h4>{{ selectedWeapon.objectName }}</h4>
                  <div class="info-badges">
                    <span class="badge badge-type">{{ selectedWeapon.type }}</span>
                    <span class="badge badge-info">{{ weaponBaseSlots.length }} åŸºç¡€æ’æ§½</span>
                    <span class="badge badge-success">{{ availableSlots.length }} å¯ç”¨æ’æ§½</span>
                  </div>
                </div>
              </div>

              <!-- æ’æ§½ç½‘æ ¼ -->
              <div v-if="selectedWeapon" class="slots-grid-container">
                <h4 class="section-title">é…ä»¶æ’æ§½ ({{ availableSlots.length }})</h4>
                <div class="slots-grid">
                  <div v-for="slot in availableSlots" :key="slot.slotId + slot.slotOrder"
                       class="slot-grid-item"
                       :class="{ 'has-accessory': installedAccessories[slot.slotId], 'is-dynamic': slot.isDynamic }"
                       @click="toggleSlotMenu(slot.slotId)">

                    <!-- å·²å®‰è£…é…ä»¶ -->
                    <div v-if="installedAccessories[slot.slotId]" class="slot-content">
                      <img v-if="getInstalledAccessory(slot.slotId)?.picture"
                           :src="getInstalledAccessory(slot.slotId).picture"
                           :alt="getInstalledAccessory(slot.slotId).objectName"
                           class="accessory-image">
                      <div v-else class="accessory-placeholder">
                        {{ getInstalledAccessory(slot.slotId)?.objectName }}
                      </div>
                      <div class="slot-label">{{ slot.slotName }}</div>
                      <button @click.stop="uninstallAccessory(slot.slotId)" class="uninstall-btn" title="å¸è½½">âœ•</button>
                      <span v-if="slot.isDynamic" class="dynamic-indicator" title="åŠ¨æ€æ’æ§½">âš¡</span>
                    </div>

                    <!-- ç©ºæ’æ§½ -->
                    <div v-else class="slot-content empty">
                      <div class="empty-slot-icon">ğŸ”Œ</div>
                      <div class="slot-label">{{ slot.slotName }}</div>
                      <div class="slot-count">{{ (slotAccessories[slot.slotId] || []).length }} å¯ç”¨</div>
                      <span v-if="slot.isDynamic" class="dynamic-indicator" title="åŠ¨æ€æ’æ§½">âš¡</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- é…ä»¶é€‰æ‹©èœå•ï¼ˆå…¨å±€å¼¹çª—ï¼‰ -->
              <div v-if="activeSlotMenu" class="slot-menu-overlay" @click="activeSlotMenu = null">
                <div class="slot-menu" @click.stop>
                  <div class="menu-header">
                    <span>é€‰æ‹©é…ä»¶ - {{ availableSlots.find(s => s.slotId === activeSlotMenu)?.slotName }}</span>
                    <button @click.stop="activeSlotMenu = null" class="menu-close">âœ•</button>
                  </div>

                  <div class="menu-items">
                    <div v-for="acc in slotAccessories[activeSlotMenu]"
                         :key="acc.accessoryId"
                         @click="installAccessoryAndCloseMenu(activeSlotMenu, acc.accessoryId)"
                         class="menu-item">
                      <img v-if="acc.accessoryData.picture"
                           :src="acc.accessoryData.picture"
                           :alt="acc.accessoryName"
                           class="menu-item-image">
                      <span class="menu-item-name">{{ acc.accessoryName }}</span>
                    </div>
                    <div v-if="(slotAccessories[activeSlotMenu] || []).length === 0" class="menu-empty">
                      æš‚æ— å¯ç”¨é…ä»¶
                    </div>
                  </div>
                </div>
              </div>

              <!-- ç©ºçŠ¶æ€ -->
              <div v-if="!selectedWeapon" class="empty-state">
                <div class="empty-icon">ğŸ”«</div>
                <p>è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ­¦å™¨å¼€å§‹é…ç½®</p>
              </div>
            </div>
          </div>
        </div>

        <!-- ç»Ÿè®¡åˆ†æè§†å›¾ -->
        <div v-if="currentView === 'statistics'" class="statistics-view">
          <div class="view-header">
            <h2>
              <span class="icon">ğŸ“Š</span> ç»Ÿè®¡åˆ†æ
            </h2>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <h3>ç‰©å“ç»Ÿè®¡</h3>
              <div class="stat-item">
                <span class="label">æ­¦å™¨æ€»æ•°:</span>
                <span class="value">{{ weaponsCount }}</span>
              </div>
              <div class="stat-item">
                <span class="label">é…ä»¶æ€»æ•°:</span>
                <span class="value">{{ accessoriesCount }}</span>
              </div>
              <div class="stat-item">
                <span class="label">å¼¹è¯æ€»æ•°:</span>
                <span class="value">{{ ammunitionsCount }}</span>
              </div>
              <div class="stat-item">
                <span class="label">é˜²æŠ¤è£…å¤‡:</span>
                <span class="value">{{ protectionCount }}</span>
              </div>
            </div>

            <div class="stat-card">
              <h3>ä»·æ ¼ç»Ÿè®¡</h3>
              <div class="stat-item">
                <span class="label">æœ€é«˜ä»·æ ¼:</span>
                <span class="value price">Â¥{{ maxPrice?.toLocaleString() }}</span>
              </div>
              <div class="stat-item">
                <span class="label">å¹³å‡ä»·æ ¼:</span>
                <span class="value price">Â¥{{ avgPrice?.toLocaleString() }}</span>
              </div>
              <div class="stat-item">
                <span class="label">ä¸­ä½æ•°:</span>
                <span class="value price">Â¥{{ medianPrice?.toLocaleString() }}</span>
              </div>
            </div>

            <div class="stat-card full-width">
              <h3>æ•°æ®å®Œæ•´æ€§</h3>
              <div class="progress-item">
                <span class="label">æ•°æ®åŠ è½½è¿›åº¦</span>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 100%"></div>
                </div>
                <span class="value">100%</span>
              </div>
            </div>
          </div>

          <!-- å›¾è¡¨åŒºåŸŸ -->
          <div class="charts-container">
            <div class="chart-card">
              <h3>æ­¦å™¨ç±»å‹åˆ†å¸ƒ</h3>
              <canvas id="weaponTypeChart"></canvas>
            </div>
            <div class="chart-card">
              <h3>é…ä»¶ç±»å‹åˆ†å¸ƒ</h3>
              <canvas id="accessoryTypeChart"></canvas>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- ç¼–è¾‘å¯¹è¯æ¡† -->
    <div v-if="showEditDialog" class="modal-overlay" @click="closeEditDialog">
      <div class="modal-dialog" @click.stop>
        <div class="modal-header">
          <h3>{{ editingItem.objectID ? 'ç¼–è¾‘' : 'æ·»åŠ ' }}ç‰©å“</h3>
          <button @click="closeEditDialog" class="btn-close">âœ•</button>
        </div>
        <div class="modal-body">
          <form @submit.prevent="saveEditedItem">
            <div class="form-group">
              <label>ç‰©å“åç§°</label>
              <input v-model="editingItem.objectName" type="text" required class="form-control">
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Object ID</label>
                <input v-model="editingItem.objectID" type="number" required class="form-control">
              </div>
              <div class="form-group">
                <label>å†…éƒ¨ ID</label>
                <input v-model="editingItem.id" type="number" required class="form-control">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>ä»·æ ¼</label>
                <input v-model.number="editingItem.avgPrice" type="number" class="form-control">
              </div>
              <div class="form-group">
                <label>å“è´¨ç­‰çº§</label>
                <input v-model.number="editingItem.grade" type="number" min="0" max="6" class="form-control">
              </div>
            </div>
            <div class="form-group">
              <label>å›¾ç‰‡é“¾æ¥</label>
              <input v-model="editingItem.picture" type="url" class="form-control">
            </div>
            <div class="modal-footer">
              <button type="button" @click="closeEditDialog" class="btn btn-secondary">å–æ¶ˆ</button>
              <button type="submit" class="btn btn-primary">ä¿å­˜</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- é¢„è§ˆå¯¹è¯æ¡† -->
    <div v-if="showPreviewDialog" class="modal-overlay" @click="closePreviewDialog">
      <div class="modal-dialog modal-preview" @click.stop>
        <div class="modal-header">
          <h3>{{ previewingItem.objectName }}</h3>
          <button @click="closePreviewDialog" class="btn-close">âœ•</button>
        </div>
        <div class="modal-body preview-body">
          <div class="preview-layout">
            <!-- å·¦ä¾§ï¼šå›¾ç‰‡ -->
            <div class="preview-image-section">
              <img v-if="previewingItem.imageData" :src="previewingItem.imageData" :alt="previewingItem.objectName" class="preview-image">
              <div v-else class="preview-no-image">æš‚æ— å›¾ç‰‡</div>
            </div>

            <!-- å³ä¾§ï¼šè¯¦ç»†ä¿¡æ¯ -->
            <div class="preview-details">
              <div class="detail-section">
                <h4>åŸºæœ¬ä¿¡æ¯</h4>
                <div class="detail-item">
                  <span class="detail-label">ID:</span>
                  <span class="detail-value">{{ previewingItem.objectID }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">åç§°:</span>
                  <span class="detail-value">{{ previewingItem.objectName }}</span>
                </div>
                <div class="detail-item" v-if="previewingItem.type">
                  <span class="detail-label">ç±»å‹:</span>
                  <span class="detail-value badge badge-type">{{ previewingItem.type }}</span>
                </div>
                <div class="detail-item" v-if="previewingItem.category">
                  <span class="detail-label">åˆ†ç±»:</span>
                  <span class="detail-value">{{ previewingItem.category }}</span>
                </div>
                <div class="detail-item" v-if="previewingItem.grade !== undefined">
                  <span class="detail-label">å“è´¨:</span>
                  <span class="detail-value badge badge-grade">ç­‰çº§{{ previewingItem.grade }}</span>
                </div>
                <div class="detail-item" v-if="previewingItem.avgPrice">
                  <span class="detail-label">ä»·æ ¼:</span>
                  <span class="detail-value price">Â¥{{ previewingItem.avgPrice?.toLocaleString() }}</span>
                </div>
              </div>

              <!-- æ­¦å™¨ä¸“å±å±æ€§ -->
              <div class="detail-section" v-if="previewingItem.category === 'weapon'">
                <h4>æ­¦å™¨å±æ€§</h4>
                <div class="detail-item" v-if="previewingItem.caliber">
                  <span class="detail-label">å£å¾„:</span>
                  <span class="detail-value">{{ previewingItem.caliber }}</span>
                </div>
                <div class="detail-item" v-if="previewingItem.meatHarm">
                  <span class="detail-label">ä¼¤å®³:</span>
                  <span class="detail-value">{{ previewingItem.meatHarm }}</span>
                </div>
                <div class="detail-item" v-if="previewingItem.verticalRecoil">
                  <span class="detail-label">å‚ç›´åååŠ›:</span>
                  <span class="detail-value">{{ previewingItem.verticalRecoil }}</span>
                </div>
                <div class="detail-item" v-if="previewingItem.horizontalRecoil">
                  <span class="detail-label">æ°´å¹³åååŠ›:</span>
                  <span class="detail-value">{{ previewingItem.horizontalRecoil }}</span>
                </div>
                <div class="detail-item" v-if="previewingItem.capacity">
                  <span class="detail-label">å®¹é‡:</span>
                  <span class="detail-value">{{ previewingItem.capacity }}</span>
                </div>
                <div class="detail-item" v-if="previewingItem.firingRate">
                  <span class="detail-label">å°„é€Ÿ:</span>
                  <span class="detail-value">{{ previewingItem.firingRate }} RPM</span>
                </div>
              </div>

              <!-- é…ä»¶ä¸“å±å±æ€§ -->
              <div class="detail-section" v-if="previewingItem.category === 'accessory'">
                <h4>é…ä»¶å±æ€§</h4>
                <div class="detail-item" v-if="previewingItem.quickSeparate !== undefined">
                  <span class="detail-label">å¿«é€Ÿæ‹†å¸:</span>
                  <span class="detail-value">{{ previewingItem.quickSeparate ? 'æ˜¯' : 'å¦' }}</span>
                </div>
                <div class="detail-item" v-if="previewingItem.gunSoundEffect">
                  <span class="detail-label">å£°éŸ³æ•ˆæœ:</span>
                  <span class="detail-value">{{ previewingItem.gunSoundEffect }}</span>
                </div>
              </div>

              <!-- èƒŒåŒ…/èƒ¸æŒ‚æ ¼å­å¸ƒå±€ -->
              <div class="detail-section" v-if="(previewingItem.category === 'backpack' || previewingItem.category === 'chest') && previewingItem.grid && previewingItem.grid.length > 0">
                <h4>æ ¼å­å¸ƒå±€</h4>
                <div class="grid-layout-container">
                  <div class="grid-display"
                       :style="{
                         gridTemplateColumns: 'repeat(' + calculateGridLayout(previewingItem).gridWidth + ', 40px)',
                         gridTemplateRows: 'repeat(' + calculateGridLayout(previewingItem).gridHeight + ', 40px)'
                       }">
                    <div v-for="cell in calculateGridLayout(previewingItem).cells"
                         :key="cell.index"
                         class="grid-cell-item"
                         :style="{
                           gridColumnStart: cell.x + 1,
                           gridColumnEnd: cell.x + cell.width + 1,
                           gridRowStart: cell.y + 1,
                           gridRowEnd: cell.y + cell.height + 1
                         }">
                      <span class="cell-size">{{ cell.width }}Ã—{{ cell.height }}</span>
                    </div>
                  </div>
                </div>
                <div class="grid-info">
                  <span>æ€»å®¹é‡: {{ previewingItem.capacity }} æ ¼</span>
                  <span>æ ¼å­æ•°: {{ previewingItem.grid.length }}</span>
                  <span>ç½‘æ ¼å°ºå¯¸: {{ calculateGridLayout(previewingItem).gridWidth }}Ã—{{ calculateGridLayout(previewingItem).gridHeight }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button @click="editItem(previewingItem)" class="btn btn-primary">ç¼–è¾‘</button>
          <button @click="closePreviewDialog" class="btn btn-secondary">å…³é—­</button>
        </div>
      </div>
    </div>

    <!-- åŠ è½½æç¤º -->
    <div v-if="loading" class="loading-overlay">
      <div class="loading-spinner"></div>
      <p>{{ loadingMessage }}</p>
    </div>
  </div>

  <script src="src/app.js"></script>
</body>
</html>
